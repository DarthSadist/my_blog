# WordPress с интеграцией Telegram бота

## Описание проекта

Данный проект представляет собой локальную среду разработки WordPress, интегрированную с Telegram ботом. Система позволяет автоматически создавать и публиковать записи в WordPress блоге через сообщения, отправленные в Telegram бот.

## Текущее состояние проекта

### Основные компоненты

1. **WordPress в Docker-контейнере**
   - Локальная разработка на `http://localhost:8000`
   - WordPress настроен с поддержкой REST API
   - Настроены постоянные ссылки (permalinks) в формате отличном от "Обычные"

2. **Плагин Telegram to WP AutoPost**
   - Полностью функциональный плагин для WordPress
   - Обеспечивает интеграцию между Telegram и WordPress через REST API
   - Создаёт записи на основе сообщений из Telegram
   - Поддерживает работу с хэштегами, которые преобразуются в метки (теги) WordPress
   - Включает возможность обработки медиафайлов из Telegram (фото, документы, видео, аудио)

3. **Telegram бот**
   - Настроен бот с именем `@denis_myblog_bot`
   - API токен: сохранен в конфигурационном файле
   - Поддерживает как long polling, так и webhook методы работы

### Файловая структура

- **docker-compose.yml** - Конфигурация Docker для запуска WordPress
- **wp-config.php** - Основной конфигурационный файл WordPress
- **telegram-to-wp.php** - Основной файл плагина для интеграции с Telegram
- **telegram-bot.php** - Скрипт для работы с Telegram API через long polling
- **bot-config.php** - Конфигурация Telegram бота (токен и другие настройки)
- **wp-content/** - Директория с содержимым WordPress

### Функциональность плагина

#### REST API Endpoint

Плагин регистрирует REST API endpoint по адресу:
```
/wp-json/telegram/v1/post
```

Этот endpoint принимает POST-запросы от Telegram бота со следующей структурой данных:
```json
{
  "message": {
    "message_id": 12345,
    "from": {
      "id": 123456789,
      "first_name": "Имя",
      "last_name": "Фамилия",
      "username": "username"
    },
    "chat": {
      "id": 123456789,
      "first_name": "Имя",
      "last_name": "Фамилия",
      "username": "username",
      "type": "private"
    },
    "date": 1713698320,
    "text": "Текст сообщения с #хэштегами"
  }
}
```

#### Обработка запросов

Плагин выполняет следующие действия при получении запроса:

1. Проверяет валидность запроса и секретный токен (если настроен)
2. Извлекает текст сообщения и информацию о пользователе
3. Обрабатывает хэштеги в тексте, преобразуя их в метки WordPress
4. Проверяет наличие медиа-файлов в сообщении
5. Создаёт новую запись в WordPress с соответствующим содержимым
6. Прикрепляет медиа-файлы к посту, если они были в сообщении
7. Возвращает ответ с информацией о созданном посте

#### Настройки плагина

Плагин добавляет страницу настроек в административной панели WordPress, которая позволяет настроить:

- Секретный токен для защиты API endpoint
- Категорию по умолчанию для новых постов
- Статус публикации по умолчанию (черновик, опубликовано, на модерации)
- Форматирование текста и дополнительные параметры

### Методы интеграции с Telegram

Проект поддерживает два метода получения сообщений от Telegram:

1. **Long Polling (текущий метод)**
   - Использует скрипт `telegram-bot.php` для периодического опроса API Telegram
   - Подходит для локальной разработки и серверов без публичного URL
   - Требует постоянно запущенного процесса PHP

2. **Webhook (подготовлено для будущего использования)**
   - Использует конечную точку REST API `/wp-json/telegram/v1/post`
   - Требует публично доступного HTTPS URL
   - Более эффективный метод, не требующий постоянных запросов к API

## Тестирование

Интеграция была успешно протестирована:

1. Проверка доступности базового REST API WordPress
2. Тестовые запросы к конечной точке Telegram
3. Успешное создание записей на основе тестовых сообщений

## Установка и запуск

1. Клонировать репозиторий:
   ```bash
   git clone https://github.com/DarthSadist/my_blog.git
   cd my_blog
   ```

2. Запустить Docker-контейнер с WordPress:
   ```bash
   docker-compose up -d
   ```

3. Открыть WordPress в браузере: http://localhost:8000

4. Активировать плагин "Telegram to WP AutoPost" в административной панели

5. Запустить скрипт для получения сообщений от Telegram:
   ```bash
   php telegram-bot.php
   ```

## Дальнейшие планы развития

1. Перейти на метод webhook, когда будет доступен публичный HTTPS URL
2. Улучшить обработку различных типов медиа-файлов
3. Добавить более сложные команды для управления блогом через Telegram
4. Реализовать дополнительные функции форматирования текста
5. Добавить поддержку массовой загрузки фотографий в галереи
